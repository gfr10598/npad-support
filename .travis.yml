dist: trusty
language: ruby
services:
- docker

script:
- docker pull gcr.io/mlab-pub/github-m-lab-builder:latest
- docker run -v `pwd`/slicebase-i386:/root/builder/build/slicebase-i386 -v `pwd`/bin:/root/bin
  gcr.io/mlab-pub/github-m-lab-builder /root/bin/build_npad.sh

before_install:
- if [[ -n "$encrypted_9bceeca3f3aa_iv" ]] ; then
- openssl aes-256-cbc -K $encrypted_9bceeca3f3aa_key -iv $encrypted_9bceeca3f3aa_iv
  -in $TRAVIS_BUILD_DIR/travis/legacy-rpm-writer.json.enc -out /tmp/legacy-rpm-writer.json -d
- $TRAVIS_BUILD_DIR/travis/install_gcloud.sh

  # NB: Travis has a Google AppEngine (gae) provider, however it does not work
  # # here (unknown).
  # # Deploy steps never trigger on a new Pull Request. Deploy steps will trigger
  # # after a merge with matching "on:" conditions.
  #
deploy:
# SANDBOX: before code review for development code in a specific branch.
 - provider: script
   script: $TRAVIS_BUILD_DIR/travis/deploy_app.sh mlab-sandbox
     /tmp/legacy-rpm-writer.json
     $TRAVIS_BUILD_DIR/cmd/epoxy_boot_server
   skip_cleanup: true
   on:
     repo: m-lab/epoxy
     # Consider all branches and match using the condition. By default
     # "all_branches" is false, and the condition is ignored.
     all_branches: true
     # A bash-style 'if' condition, matching branches with a "sandbox-" prefix.
     condition: $TRAVIS_BRANCH == sandbox-*
